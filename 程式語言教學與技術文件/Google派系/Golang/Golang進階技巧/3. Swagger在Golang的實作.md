#程式語言教學與技術文件 #Google派系 #Golang #Golang進階技巧 #後端工具
# Swagger in Golang -- Swaggo

Swaggo是一個給Golang使用Swagger的模組，他可以用在各種的框架上，目前我這邊主要使用的是**Gin架構**，所以全部都以此為基底說明。

## 如何使用Swaggo
使用Swaggo的方式很簡單，直接在專案上先裝配swaggo就好了，如果不知道怎麼用，可以參考[4. Golang Go Mod](../../../../程式語言教學與技術文件/Google派系/Golang的一些特別概念與技巧/4.%20Golang%20Go%20Mod.md)來處理就可以

## Swaggo相關安裝與連結

- 以下是Swaggo的連結： [Swago Github](https://github.com/swaggo/swag?tab=readme-ov-file#use-multiple-path-params)

接下來就用這個來安裝就好。
```bash
go install github.com/swaggo/swag/cmd/swag@latest
```

## 使用swaggo
使用swaggo會依據不同的框架有不同的用法，我目前使用的Gin架構，所以就用這部份來說明：

```go

package main

import (
	"net/http"
	"time"

	_ "gomock/docs" //要加上去，就是專案名稱/docs，這樣swagger才找的到你生出來的東西

	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
	files "github.com/swaggo/files"  //swagger go必須要加進去的套件之一
	ginSwagger "github.com/swaggo/gin-swagger"   //swagger go必須要加進去的套件之一
)

//模擬用戶資料的API
type User struct{
	ID int `json:"id"`
	Name string `json:"name"`
	Age int `json:"age"`
}

//模擬錯誤的API
type Error struct{
	Code int `json:"code"`
	Message string `json:"message"`
}

//===============這段是swaggo註解，不懂可以看Github==========
// @title Swagger Example API
// @version 1.0
// @description This is a sample server.
// @host localhost:8080
// @BasePath /api
//=========================================================

func main(){
	//創建 Gin路由引擎
	r := gin.Default()

	//設定路由
	config := cors.Config{
		AllowAllOrigins: true,
		AllowMethods: []string{"GET","POST","PUT","DELETE"},
		AllowHeaders:     []string{"Origin", "Content-Type", "Authorization"},
        ExposeHeaders:    []string{"Content-Length"},
        MaxAge:           12 * time.Hour,
	}

	r.Use(cors.New(config))

	r.GET("/swagger/*any", ginSwagger.WrapHandler(files.Handler)) //加上這段就可以開啟swagger

	//定義路由和處理函數
	r.GET("api/users/:id",getUser)

	/*r.POST("/api/user/create", func(c *gin.Context) {
        // 假設前端發送的 JSON 請求是新用戶資料
        var newUser User
        if err := c.ShouldBindJSON(&newUser); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
            return
        }

        // 模擬成功創建用戶的回應
        c.JSON(http.StatusOK, gin.H{
            "message": "User created successfully",
            "user":    newUser,
        })
    })*/

	// 啟動伺服器，監聽 8080 埠
    r.Run(":8080")
}

// @Summary Show a user	
// @Description Get user by ID
// @Tags users
// @Accept  json
// @Produce  json
// @Param id path int true "User ID"
// @Success 200 {object} User
// @Failure 400 {object} Error
// @Router /users/{id} [get]
func getUser(c *gin.Context){
	//返回假用戶資料
	user := User{
		ID: 1,
		Name: "Jhon Doe",
		Age: 30,
	}
	c.JSON(http.StatusOK,user)
}

func updateUser(c *gin.Context){
	// 假設前端發送的 JSON 請求是新用戶資料
	var newUser User
	if err := c.ShouldBindJSON(&newUser); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}

	 // 模擬成功創建用戶的回應
	 c.JSON(http.StatusOK, gin.H{
		 "message": "User created successfully",
		 "user":    newUser,
	 })
}

```

接下來執行這個指令就會自動生成swagger docs了
```bash
swag init

```

## 同場加映：多資料夾下的swag init

swag init可以幫助我們抓取go檔案他讀得懂的swag註解，但它預設只會抓取**main.go**，並不會抓取其他的go檔案，更遑論其他資料夾下的go檔案了，所以如果要抓取某個go檔案的swagger註解到你的swaggo當中，可以這樣做：

```bash
swag init -g ./conn/server.go
```

這樣就可以順利的抓取conn/server.go下的swaggo註解，並寫進去swagger裡面，<font class="red-text">**但swag init並無法迴遞抓取資料夾內的所有go檔案**</font>，那這樣的話如果我的資料夾內有20個go檔，那我就要20次，這樣會太浪費時間。所以建議寫個腳本來處理這種問題會比較好。